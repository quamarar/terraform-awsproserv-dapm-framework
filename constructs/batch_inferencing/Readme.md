# Batch inferencing module

Resources created

1. 3x SSM parameters
2. 3x DDB
3. 5x Glue Jobs

## Sample input

Below is the sample input which is accepted by step function. All of it will be dynamically generated by Jenkins Pipeline.

```json
    {
        "athena_pred_or_eval_table_name": "evaluation",
        "athenadb_name": "default",
        "athenadb_debug_table_name": "debug",
        "athenadb_evaluation_summary_table_name": "model_eval_summary",
        "train_statetable_name": "trainstatetable",
        "train_inputtable_name": "traininputtable",
        "train_metatable_name": "trainmetatable",
        "s3_bucket_name_internal": "msil-poc-apsouth1-internal",
        "s3_bucket_name_shared": "msil-poc-apsouth1-shared",
        "mapping_json_S3_path": "s3://msil-poc-apsouth1-internal/mapping_json/mapping_json.json",
        "aws_batch_job_definition_arn": "arn:aws:batch:ap-south-1:731580992380:job-definition/test-training:3", # Moved to ssm param (update to take it as input)
        "region": "ap-south-1",
        "year": "2023",
        "month": "10",
        "day": "14",
        "use_case_name": "DCP",
        "aws_batch_job_queue": "arn:aws:batch:ap-south-1:731580992380:job-queue/test-training",
        "aws_batch_job_name": "aws_demo_batch_run",
        "athenadb_metadata_table_name": "meta",
        "ssm_training_complete_status": "training_complete_status",
        "dq_athena_db": "poc_monitoring",
        "dq_table": "dqresults",
        "email_topic_arn": "arn:aws:sns:ap-south-1:731580992380:model_start_dq_notification",
        "training_event_bus_name": "async_monitoring_event_bus",
        "repository":"github/maruti-modelops/quality-mlops-defect-corelation-and-prediction.git"
    }
```

### Segreation of input

- Terraform outputed values which will be stored in SSM params for Jenkins to pull in run time.

```json
    {
        "athenadb_name": "default",
        "athenadb_evaluation_summary_table_name": "model_eval_summary",
        "train_statetable_name": "trainstatetable",
        "train_inputtable_name": "traininputtable",
        "train_metatable_name": "trainmetatable",
        "s3_bucket_name_internal": "msil-poc-apsouth1-internal",
        "s3_bucket_name_shared": "msil-poc-apsouth1-shared",
        "aws_batch_job_definition_arn": "arn:aws:batch:ap-south-1:731580992380:job-definition/test-training:3", # Moved to ssm param (update to take it as input)
        "aws_batch_job_queue": "arn:aws:batch:ap-south-1:731580992380:job-queue/test-training",
        "aws_batch_job_name": "aws_demo_batch_run",
        "ssm_training_complete_status": "training_complete_status",
        "dq_athena_db": "poc_monitoring",
        "dq_table": "dqresults",
        "email_topic_arn": "arn:aws:sns:ap-south-1:731580992380:model_start_dq_notification",
        "training_event_bus_name": "async_monitoring_event_bus",
        "repository":"github/maruti-modelops/quality-mlops-defect-corelation-and-prediction.git"
    }
```

- Dynamically generated values by jenkins by
    1. Reading **`tfvars.json`** for `region` and `use_case_name`.
    2. Reading current repo url from `git origin`.
    3. Generating `mapping_json` path appending internal bucket.
    4. Fetching execuation date.
    5. athena Tables?

```json
    {
        "athena_pred_or_eval_table_name": "evaluation",
        "athenadb_evaluation_summary_table_name": "model_eval_summary",
        "athenadb_metadata_table_name": "meta",
        "dq_table": "dqresults",
        "mapping_json_S3_path": "s3://msil-poc-apsouth1-internal/mapping_json/mapping_json.json",
        "region": "ap-south-1",
        "year": "2023",
        "month": "10",
        "day": "14",
        "region": "ap-south-1",
        "use_case_name": "DCP",
        "repository":"github/maruti-modelops/quality-mlops-defect-corelation-and-prediction.git"
    }
```
